# ğŸ“„ æ™ºèƒ½æƒ…ç»ªè¯†åˆ«å™¨ï¼šæœ€ç»ˆæŠ€æœ¯æ–‡æ¡£ (ResNet50ç‰ˆ)

### ğŸŒŸ é¡¹ç›®åç§°ï¼šåŸºäº ResNet50 çš„çœŸå®åœºæ™¯æƒ…ç»ªè¯†åˆ«ç³»ç»Ÿ

**ç›®æ ‡ï¼š** æ„å»ºä¸€ä¸ªåŸºäº**è¿ç§»å­¦ä¹  (Transfer Learning)** çš„é«˜æ€§èƒ½è®¡ç®—æœºè§†è§‰ç³»ç»Ÿï¼Œåˆ©ç”¨é¢„è®­ç»ƒçš„ ResNet50 æ¨¡å‹å’ŒçœŸå®ä¸–ç•Œæ•°æ®é›† (RAF-DB)ï¼Œåœ¨å¤æ‚å…‰ç…§å’Œå§¿æ€ä¸‹å®ç°é«˜å‡†ç¡®ç‡çš„å®æ—¶äººè„¸æƒ…ç»ªè¯†åˆ«ã€‚

-----

## ğŸš€ é˜¶æ®µ Iï¼šæ•°æ®å‡†å¤‡ä¸é¢„å¤„ç† (RAF-DB é‡æ„ç‰ˆ)

**æè¿°ï¼š** æ”¾å¼ƒäº†ä½åˆ†è¾¨ç‡çš„ç°åº¦æ•°æ®é›† (FER-2013)ï¼Œå…¨é¢è½¬å‘åŒ…å«çœŸå®ä¸–ç•Œå…‰ç…§å’Œè‚¤è‰²ä¿¡æ¯çš„ RGB æ•°æ®é›†ï¼Œä»¥åŒ¹é… ResNet çš„è¾“å…¥è¦æ±‚ã€‚

### 1. æ•°æ®é›†æ¦‚è§ˆ
*   **æ•°æ®é›†åç§°ï¼š** RAF-DB (Real-world Affective Faces Database) - Kaggle 75px ç‰ˆæœ¬
*   **æ•°æ®ç‰¹æ€§ï¼š**
    *   **çœŸå®æ€§ï¼š** åŒ…å«ä¾§è„¸ã€é®æŒ¡ã€ä¸åŒå…‰ç…§æ¡ä»¶ï¼Œç¬¦åˆæ‘„åƒå¤´çœŸå®ä½¿ç”¨åœºæ™¯ã€‚
    *   **è‰²å½©ï¼š** **RGB ä¸‰é€šé“** (ä¿ç•™äº†è‚¤è‰²çº¢æ¶¦/è‹ç™½ç­‰ç”Ÿç†ç‰¹å¾)ã€‚
    *   **åŸå§‹å°ºå¯¸ï¼š** $75 \times 75$ åƒç´  (å¯¹é½å)ã€‚
*   **ç±»åˆ« (7ç§)ï¼š** Angry, Disgust, Fear, Happy, Neutral, Sad, Surpriseã€‚
*   **æ•°æ®åˆ’åˆ†ï¼š**
    *   **Train (è®­ç»ƒé›†)ï¼š** ç”¨äºæ¨¡å‹æ‹Ÿåˆã€‚
    *   **Val (éªŒè¯é›†)ï¼š** ç”¨äºè®­ç»ƒä¸­çš„è¶…å‚æ•°è°ƒæ•´å’Œ Early Stoppingã€‚
    *   **Test (æµ‹è¯•é›†)ï¼š** ç”¨äºæœ€ç»ˆæ¨¡å‹çš„å®¢è§‚è¯„åˆ†ã€‚

### 2. å…³é”®é¢„å¤„ç†æµç¨‹ (Pipeline)

| å¤„ç†æ­¥éª¤ | æŠ€æœ¯å®ç° | ç›®çš„ |
| :--- | :--- | :--- |
| **æ™ºèƒ½è·¯å¾„æ£€æµ‹** | `os.path.exists` | è‡ªåŠ¨è¯†åˆ« `val` æˆ– `test` æ–‡ä»¶å¤¹ï¼Œé˜²æ­¢è·¯å¾„æŠ¥é”™ã€‚ |
| **å°ºå¯¸ä¸Šé‡‡æ ·** | `target_size=(224, 224)` | å°† 75px å›¾ç‰‡**æ”¾å¤§**è‡³ ResNet50 æ ‡å‡†è¾“å…¥å°ºå¯¸ï¼Œä¿ç•™äº”å®˜è½®å»“ã€‚ |
| **è‰²å½©æ¨¡å¼** | `color_mode='rgb'` | **å…³é”®å˜æ›´**ï¼šæ”¾å¼ƒç°åº¦ï¼Œä½¿ç”¨ 3 é€šé“æ•°æ®ä»¥åˆ©ç”¨é¢„è®­ç»ƒæƒé‡ã€‚ |
| **å½’ä¸€åŒ–** | `rescale=1./255` | å°†åƒç´ å€¼ä» [0, 255] æ˜ å°„åˆ° [0, 1] æµ®ç‚¹æ•°ã€‚ |
| **æ•°æ®å¢å¼º** | Rotation, Shift, Shear, Zoom | ä»…åº”ç”¨äºè®­ç»ƒé›†ï¼Œå¢åŠ æ•°æ®å¤šæ ·æ€§ï¼Œé˜²æ­¢è¿‡æ‹Ÿåˆã€‚ |

-----

## ğŸ§  é˜¶æ®µ IIï¼šæ¨¡å‹æ¶æ„ä¸è®­ç»ƒ (è¿ç§»å­¦ä¹ ç‰ˆ)

**æè¿°ï¼š** é‡‡ç”¨â€œç«™åœ¨å·¨äººè‚©è†€ä¸Šâ€çš„ç­–ç•¥ï¼Œåˆ©ç”¨åœ¨ ImageNet ä¸Šé¢„è®­ç»ƒçš„ ResNet50 æå–é«˜çº§ç‰¹å¾ï¼Œä»…é’ˆå¯¹è¡¨æƒ…åˆ†ç±»ä»»åŠ¡è®­ç»ƒé¡¶å±‚åˆ†ç±»å™¨ã€‚

### 1. æ¨¡å‹æ¶æ„è®¾è®¡

*   **éª¨å¹²ç½‘ç»œ (Backbone)ï¼š** **ResNet50**
    *   **æ¥æºï¼š** `tf.keras.applications.ResNet50`
    *   **æƒé‡ï¼š** `ImageNet` (é¢„è®­ç»ƒæƒé‡)ã€‚
    *   **çŠ¶æ€ï¼š** **Frozen (å†»ç»“)**ã€‚å…¶å†…éƒ¨çš„ 2300 ä¸‡ä¸ªå‚æ•°ä¸å‚ä¸è®­ç»ƒï¼Œä»…ä½œä¸ºç‰¹å¾æå–å™¨ã€‚
*   **ç‰¹å¾èåˆå±‚ï¼š** `GlobalAveragePooling2D`
    *   å°† ResNet è¾“å‡ºçš„ $7 \times 7 \times 2048$ ç‰¹å¾å›¾å‹ç¼©ä¸º 2048 ç»´å‘é‡ã€‚
*   **åˆ†ç±»å¤´ (Custom Head)ï¼š**
    *   `Dense(512, ReLU)`: å­¦ä¹ è¡¨æƒ…ä¸“å±çš„è¯­ä¹‰ç‰¹å¾ã€‚
    *   `Dropout(0.5)`: å¼ºåŠ›æ­£åˆ™åŒ–ï¼Œé˜²æ­¢è¿‡æ‹Ÿåˆã€‚
    *   `Dense(7, Softmax)`: è¾“å‡ºæœ€ç»ˆæ¦‚ç‡ã€‚

### 2. è®­ç»ƒé…ç½®

| é…ç½®é¡¹ | å€¼ / æè¿° |
| :--- | :--- |
| **è¾“å…¥å½¢çŠ¶** | `(224, 224, 3)` |
| **ä¼˜åŒ–å™¨** | `Adam(learning_rate=1e-4)` (ä½å­¦ä¹ ç‡ä»¥ä¿æŒç¨³å®šæ€§) |
| **æŸå¤±å‡½æ•°** | `categorical_crossentropy` |
| **å‚æ•°é‡** | æ€»å‚æ•°: ~2460ä¸‡ / **å¯è®­ç»ƒå‚æ•°: ~100ä¸‡** |
| **å›è°ƒç­–ç•¥** | `ModelCheckpoint` (ä¿ä¼˜), `EarlyStopping` (Patience=10), `ReduceLROnPlateau` (è‡ªåŠ¨é™å­¦ä¹ ç‡)ã€‚ |

-----

## ğŸ¯ é˜¶æ®µ IIIï¼šå®æ—¶éƒ¨ç½²ä¸æ¨ç† (RGB é€‚é…ç‰ˆ)

**æè¿°ï¼š** æ›´æ–°äº†æ¨ç†ç®¡é“ï¼Œä½¿å…¶èƒ½å¤Ÿå¤„ç†æ‘„åƒå¤´çš„ RGB æ•°æ®å¹¶é€‚é…æ–°çš„æ¨¡å‹è¾“å…¥å°ºå¯¸ã€‚

### 1. æ¨ç†é€»è¾‘ (`src/webcam_demo.py`)

*   **äººè„¸æ£€æµ‹ï¼š** ä¾ç„¶ä½¿ç”¨ Haar Cascade (`haarcascade_frontalface_default.xml`) è¿›è¡Œå¿«é€Ÿå®šä½ã€‚
*   **é¢„å¤„ç†æµæ°´çº¿ (å…³é”®å·®å¼‚)ï¼š**
    1.  **æˆªå– ROIï¼š** ä»åŸå§‹å¸§ä¸­åˆ‡å‡ºäººè„¸ã€‚
    2.  **è‰²å½©è½¬æ¢ï¼š** `cv2.cvtColor(roi, cv2.COLOR_BGR2RGB)` â€”â€” **å¿…é¡»æ­¥éª¤**ï¼ŒOpenCV é»˜è®¤æ˜¯ BGRï¼ŒResNet è®­ç»ƒç”¨çš„æ˜¯ RGBã€‚
    3.  **å°ºå¯¸è°ƒæ•´ï¼š** `cv2.resize(roi, (224, 224))` â€”â€” å¼ºåˆ¶ç¼©æ”¾ä»¥åŒ¹é…æ¨¡å‹å…¥å£ã€‚
    4.  **å½’ä¸€åŒ–ï¼š** é™¤ä»¥ 255.0ã€‚
    5.  **ç»´åº¦æ‰©å±•ï¼š** å¢åŠ  Batch ç»´åº¦ `(1, 224, 224, 3)`ã€‚

-----

## ğŸ”® é˜¶æ®µ IVï¼šæœªæ¥ä¼˜åŒ–è·¯çº¿å›¾ (Roadmap)

è™½ç„¶ç›®å‰çš„ç³»ç»Ÿå·²ç»å…·å¤‡äº†å·¥ä¸šçº§çš„åŸºç¡€ï¼Œä½†ä¸ºäº†å†²å‡» **85%+** çš„å‡†ç¡®ç‡ï¼Œåç»­å¯æ‰§è¡Œä»¥ä¸‹ä¼˜åŒ–ï¼š

### 1. æ¨¡å‹å¾®è°ƒ (Fine-tuning)
*   **ç°çŠ¶ï¼š** ResNet50 éª¨å¹²æ˜¯â€œå†»ç»“â€çš„ã€‚
*   **è®¡åˆ’ï¼š** åœ¨å½“å‰æ¨¡å‹æ”¶æ•›åï¼Œ**è§£å†»** ResNet çš„æœ€å 10-20 å±‚ï¼Œä½¿ç”¨æå°çš„å­¦ä¹ ç‡ (å¦‚ `1e-5`) é‡æ–°è®­ç»ƒã€‚è¿™èƒ½è®© ResNet çš„ç‰¹å¾æå–å™¨æ›´é€‚åº”â€œäººè„¸â€è€Œä¸æ˜¯â€œé€šç”¨ç‰©ä½“â€ã€‚

### 2. äººè„¸æ£€æµ‹å‡çº§ (YOLO)
*   **ç°çŠ¶ï¼š** Haar Cascade å¯¹ä¾§è„¸å’Œå…‰ç…§æ•æ„Ÿï¼Œå¯¼è‡´æ£€æµ‹æ¡†é—ªçƒã€‚
*   **è®¡åˆ’ï¼š** æ›¿æ¢ä¸º **YOLOv8-Face** æˆ– **MediaPipe**ã€‚
    *   YOLO æ¨¡å‹èƒ½æä¾›æå…¶ç¨³å®šçš„äººè„¸æ¡†ï¼Œå‡å°‘å› æˆªå–é”™è¯¯å¯¼è‡´çš„æƒ…ç»ªè¯¯åˆ¤ã€‚

### 3. æ•°æ®é›†æ‰©å……
*   **ç°çŠ¶ï¼š** ä½¿ç”¨çš„æ˜¯ RAF-DB çš„ 75px ç‰ˆæœ¬ã€‚
*   **è®¡åˆ’ï¼š** å¯»æ‰¾ RAF-DB çš„ **åŸå›¾ç‰ˆæœ¬** æˆ–å¼•å…¥ **AffectNet** æ•°æ®é›†ï¼Œè¿›ä¸€æ­¥æå‡æ¸…æ™°åº¦å’Œæ•°æ®å¤šæ ·æ€§ã€‚

-----

## ğŸ’» å¿«é€Ÿè¿è¡ŒæŒ‡å—

**ç¯å¢ƒè¦æ±‚ï¼š** `tensorflow`, `opencv-python`, `numpy`

**æ–‡ä»¶ç»“æ„ç¡®è®¤ï¼š**
```text
data/ -> (åŒ…å« train, val, test æ–‡ä»¶å¤¹)
models/ -> resnet50_rafdb_model.keras
src/ -> model_training.py, webcam_demo.py
```

**1. å¯åŠ¨è®­ç»ƒï¼š**
```bash
python src/model_training.py
# è®­ç»ƒç»“æŸåä¼šè‡ªåŠ¨åœ¨ Test é›†ä¸Šè¯„ä¼°å¹¶æ‰“å°æœ€ç»ˆå‡†ç¡®ç‡
```

**2. å¯åŠ¨æ‘„åƒå¤´æ¨ç†ï¼š**
```bash
python src/realtime_detector.py
# æŒ‰ 'q' é€€å‡º
```